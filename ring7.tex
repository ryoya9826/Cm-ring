\part[Homological method to ring theory]{可換環論のホモロジー代数的手法}
前章で定義した射影分解，$\Tor,\Ext$などの道具を使って可換環の理論にホモロジー代数的手法を持ち込もう．以後，$\Tor(M,N)=\Tor(N,M)$であるが$\Ext(M,N)\neq\Ext(N,M)$であることを注意してほしい．

\section{Ext と加群の深さ}
この節では，Cohen--Macaulay性を議論するために必要不可欠な深さの概念について，Extを使った言い換えを与え，ホモロジー代数の道具を用いて考察していく．まずは\ref{lem:depth M/aM=depth M-1}の証明を与えるために，深さとExtの関係，最初は簡単な場合として正則元とHomのつながりについて調べてみる．以後の命題たちの証明に\ref{lem:depth M/aM=depth M-1}は必要ないことに注意しよう．

\begin{lem}
	$A$をNoether環とし，$M$を有限生成$A$加群，$I$を$IM\neq M$となる$A$のイデアルとする．このとき，次の条件；
	\begin{sakura}
		\item $M$正則元である$a\in I$が存在する．
		\item 任意の有限生成$A$加群$N$について，$\supp N\subset V(I)$ならば$\hom(N,M)=0$である．
		\item ある有限生成$A$加群$N$が存在して，$\supp N=V(I)$かつ$\hom(N,M)=0$となる．
	\end{sakura}
	は同値である．
\end{lem}

\begin{proof}
	\begin{eqv}[3]
		\item $a$倍写像$a\cdot:M\to M$は単射である．すると，これを合成する準同型$a\cdot_ \ast:\hom(N,M)\to\hom(N,M)$も単射である．任意の$\varphi\in\hom(N,M)$をとると，$a\cdot_\ast(\varphi)$は$x\mapsto \varphi(ax)$という準同型であることに注意する．ここで$\supp N=V(\ann N)\subset V(I)$なので，\ref{prop:V(I)の包含}より$I\subset \sqrt{\ann N}$である．よってある$n>0$が存在して$a^nN=0$である．すると$\varphi$に$a\cdot_\ast$を$n$回施すとそれは$0$になり，これは単射なので$\varphi$は$0$でなければならない．
		\item $N=A/I$とすればよい．
		\item $I$は$M$正則元を持たないとする．すると\ref{lem:depth 0とass}より$P\in\ass M\cap V(I)$となる$P\in\spec A$が存在する．このとき単射$A/P\to M$が存在する（$P=\ann x$とするとき，$A/P\to M;a+P\mapsto ax$とすればよい）．これを$P$で局所化して$k(P)\to M_P$が存在する．また，$P\in V(I)=\supp N$であるので$N_P\neq 0$であり，中山の補題より$N_P/PN_P=N\otimes_A k(P)$は$0$でない$k(P)$ベクトル空間である．よって$0$でない$N_P/PN_P\to k(P)$がある．以上のことを組み合わせて$\hom_{A_P}(N_P,M_P)=\hom(N,M)_P\neq0$である．すると\ref{prop:局所化したら0は局所的}より$\hom (N,M)\neq0$であるので矛盾である．
	\end{eqv}
\end{proof}

これを正則列について一般化しよう．

\begin{prop}\label{prop:正則列とExt}
	$A$をNoether環とし，$M$を有限生成$A$加群，$I$を$IM\neq M$となる$A$のイデアルとする．任意の$n>0$について，次の条件；
	\begin{sakura}
		\item $n\leq\mdepth_I M$である．
		\item 任意の有限生成$A$加群について，$\supp N\subset V(I)$ならば任意の$0\leq i<n$について$\Ext^i(N,M)=0$である．
		\item ある有限生成$A$加群$N$が存在して，$\supp N=V(I)$かつ任意の$0\leq i<n$について$\Ext^i(N,M)=0$である．
		\item 任意の$0<i<n$について，$a_1,\dots,a_i\in I$が$M$正則列であるならば，ある$a_{i+1},\dots,a_n\in I$が存在して$a_1,\dots,a_n$が$M$正則列をなす．
	\end{sakura}
	は同値である．
\end{prop}

\begin{proof}
	\begin{eqv}[4]
		\item $n$についての帰納法で示す．$n=1$のときは先の補題でみたので，$n>1$とする．$a_1,\dots,a_n\in I$を$M$正則列とする．完全列；
		\[\ses[a_1\cdot]{M}{M}{M/a_1M}\]
		についてExtが導く完全列を考えて；
		\[\begin{tikzcd}{\Ext^{i-1}(N,M/a_1M)}\nxcell[\partial^{i-1}]{\Ext^i(N,M)}\nxcell[a_1\cdot]{\Ext^i(N,M)}\end{tikzcd}\]
		が完全である（$\Ext^i(N,M)$の間の準同型は$a_1\cdot$が誘導するコホモロジーの間の準同型だが，これは$a_1\in A$なので$a_1\cdot$のまま変わらない）．ここで$a_2,\dots,a_n$が$M/a_1M$正則列なので$n-1\leq\mdepth_I M/a_1M$だから，帰納法の仮定より$a_1\cdot:\Ext^i(N,M)\to\Ext^i(N,M)$は単射である．また\ref{lem:ExtのAnn}から$\ann N\subset\ann(\Ext^i(N,M))$であるので，補題と同様の議論で$\Ext^i(N,M)=0$である．
		\item $N=A/I$とすればよい．
		\item これも$n$についての帰納法で示す．$n=1$のときは見た．$n>1$とし，$i<n$について$a_1,\dots,a_i\in I$が$M$正則列であるとする．(iii)の条件を満たす有限生成$A$加群$N$と$a_1$倍写像についての完全列が導くExtの完全列；
		\[\begin{tikzcd}
		\Ext^{j}(N,M)\nxcell\Ext^{j}(N,M/a_1M)\nxcell[\partial^i]\Ext^{j+1}(N,M)
		\end{tikzcd}\]
		を考える．$j+1<n$のとき，仮定から完全列の両端は$0$となり，任意の$j<n-1$について$\Ext^j(N,M/a_1M)=0$である．$\supp N=V(I)$であるから，帰納法の仮定から$M/a_1M$正則列$a_2,\dots,a_i\in I$を長さ$n-1$に延長できる．よって，番号のズレに気をつけて$a_1,\dots,a_n\in I$を$M$正則列となるようにできることがわかった．
	\end{eqv}
\end{proof}

この命題から即座に次の定理が従う．
\begin{thm}[Rees]\label{thm:Extとdepth}
	$A$をNoether環とし，$M$を有限生成$A$加群，$I$を$IM\neq M$となる$A$のイデアルとする．$I$の元からなる極大な$M$正則列の長さは一定であり，また；
	\[\mdepth_I M=\inf\mkset{i\in\N}{\Ext^i(A/I,M)\neq0}\]
	である．
\end{thm}

\ref{prop:正則列とExt}によって，最初の目的が達成できる．
\begin{lem}[\ref{lem:depth M/aM=depth M-1}の証明]\label{lem:depth M/aMについての証明}
	$A$をNoether環とし，$M$を有限生成$A$加群，$I$を$IM\neq M$となる$A$のイデアルとする．$a\in I$が$M$正則ならば；
	\[\mdepth_I (M/aM)=\mdepth_I M-1\]
	が成り立つ．
\end{lem}

\begin{proof}
	$a_1,\dots,a_n\in I$が$M/aM$正則列ならば$a,a_1,\dots,a_n$は$M$正則であり，$\mdepth_I(M/aM)\leq\mdepth_I M-1$であることはすぐにわかる．また$\mdepth_I M=r$とすると，\ref{prop:正則列とExt}より$a,a_2,\dots,a_r\in I$を$M$正則列であるようにできる．このとき$a_2,\dots,a_r$は$M/aM$正則列をなすので$\mdepth_I M-1\leq\mdepth_I(M/aM)$であることがわかった．
\end{proof}

CM局所環とは$\dim A=\mdepth A$となっている環のことであったことを思い出すと，この定義はKrull次元がホモロジカルな量で与えられている局所環のことである，と言い換えることができる．Krull次元をホモロジカルな量に翻訳することで可換環論に新たな視点が持ち込まれ．\textbf{ホモロジカル予想}と呼ばれる一連の予想群が生まれることとなった．これらの予想については本書のところどころで目にすることになるだろう．

\section{射影被覆と入射包絡}

異なるホモロジカルな量として\textbf{ホモロジー次元}とも呼ばれる\textbf{射影次元}と，その双対概念であるところの\textbf{入射次元}を定義しよう．この節では，次の節でホモロジー次元を取り扱いやすくするための\textbf{射影被覆，入射包絡}について説明する．

\begin{defi}[射影次元]\index{しゃえいじげん@射影次元}
	$A$を環とし，$M$を$A$加群とする．$M$の射影分解の長さの最小値を$M$の\textbf{射影次元}(projective dimension)といい，$\prjdim_A M$とかく．$M=0$のときは$\prjdim M=-1$とする．
\end{defi}

$\prjdim M\leq 0$であることと$M$が射影的であることは同値である．

\begin{defi}[射影被覆]\index{しゃえいひふく@射影被覆}\index{よじょうかぐん@余剰加群}
	$A$加群$M$の部分加群$N$が；
	\[\text{任意の$M$の部分加群$L$について$N+L=M$なら$L=M$．}\]
	を満たすとき，$N$を$M$の\textbf{余剰部分加群}(superfluous submodule)という．$A$加群$M$について射影加群$P$と全射$\varepsilon:P\to M$が存在して$\ker\varepsilon$が$P$の余剰加群のとき，$P,\varepsilon$は$M$の\textbf{射影被覆}(projective cover)であるという．
\end{defi}

\begin{lem}\label{lem:余剰加群の補題}
	加群の準同型の列（完全性は仮定しない）$\begin{tikzcd}
	M_1\nxcell[\varphi]M_2\nxcell[\psi]M_3
	\end{tikzcd}$について, $\psi\circ\varphi$が全射であるとする． $\ker\psi $が$M_2$の余剰加群なら$\varphi$も全射である．
\end{lem}

\begin{proof}
	任意の$x\in M_2$についてある$x_1\in M_1$が存在して$\psi(\varphi(x_1))=\psi(x)$である．このとき$\varphi(x_1)-x\in\ker\psi$なので$M_2=\varphi(M_1)+\ker\psi$である．よって仮定から$M_2=\varphi(M_1)$となる．
\end{proof}

\begin{prop}\label{prop:射影被覆が同型の補題}
	$M$を$A$加群とし，$M$の射影被覆$\varepsilon:P\to M$が存在したとする．射影加群$P'$と全射$\varepsilon':P'\to M$に対して分裂全射$f:P'\to P$が存在して，次の図式；
	\[\begin{tikzcd}
		P'\arrow[dd,"f",swap]\arrow[dr,"\varepsilon'"]\\[-1.5em]
		&M\nxcell0\\[-1.5em]
		P\arrow[ur,"\varepsilon"]
	\end{tikzcd}\]
	が可換（$P'$は$P$と同型な直和因子を持つ）．
\end{prop}

\begin{proof}
	可換になる$f$の存在は$P'$が射影的であることから従う．いま$\varepsilon\circ f$が全射で$\ker\varepsilon$が余剰加群なので，補題より$f$も全射である．また$P$も射影的であるから，次の図式；
	\[\begin{tikzcd}
		P\arrow[d,"g"]\arrow[rd,"\id"]\\
		P'\nxcell[f]P\nxcell0
	\end{tikzcd}\]
	が可換になる$g:P\to P'$が存在し$f$は分裂全射である．
\end{proof}

この命題より射影被覆は\textbf{存在すれば}同型を除いて一意である．また，同様の議論で$M\cong M'$かつ$P,P'$がそれぞれの射影被覆なら$P\cong P'$である．しかしながら，一般には射影被覆が存在するかどうかわからないという問題がある（\ref{ex:射影被覆が存在しない例}）．

双対的に入射加群について考えたものが\textbf{入射包絡}であり，こちらは必ず存在する．
\begin{defi}[入射次元]\index{にゅうしゃじげん@入射次元}
	$M$を$A$加群とする． $M$の入射分解の長さの最小値を$M$の\textbf{入射次元}(injective dimension)といい，$\injdim_A M$とかく．$M=0$のときは$\injdim M=-1$とする．
\end{defi}

\begin{defi}[入射包絡]\index{ほんしつてきかぐん@本質的加群}\index{にゅうしゃほうらく@入射包絡}
	$A$加群$M$の部分加群$N$が；
	\[\text{任意の$M$の部分加群$L$について$N\cap L=0$なら$L=0$．}\]
	を満たすとき，$N$を$M$の\textbf{本質部分加群}(essential submodule)という．$A$加群$M$について入射加群$I$と単射$\varepsilon:M\to I$が存在して$\im\varepsilon$が$I$の本質加群のとき，$I,\varepsilon$は$M$の\textbf{入射包絡}(injective hull)であるという．
\end{defi}

本質部分加群については次の判定条件が強力である．
\begin{prop}\label{prop:本質的加群の判定条件}
	$A$加群$M$の部分加群$N$が本質的であることと，任意の$x\neq0\in M$について$Ax\cap N\neq0$であることは同値．
\end{prop}

\begin{proof}
	$(\Longleftarrow)$のみ示す．$N\cap L=0$かつ$L\neq0$とすると，$x\neq0\in L$がとれ，このとき$Ax\subset L$より$Ax\cap N\subset L\cap N=0$であるので$Ax\cap N=0$だがこれは矛盾．よって$L=0$である．
\end{proof}

\ref{lem:余剰加群の補題}の双対版を示しておこう．

\begin{lem}
	加群の準同型の列$\begin{tikzcd}
	M_1\nxcell[\varphi]M_2\nxcell[\psi]M_3
	\end{tikzcd}$について，$\psi\circ\varphi$が単射であるとする．$\im\varphi$が$M_2$の本質加群なら$\psi$も単射である．
\end{lem}

\begin{proof}
	任意の$x\neq0\in M_2$について$\psi(x)\neq0$を言えばよい．このとき$Ax\cap\im\varphi\neq0$であるので，ある$a\in A$が存在して$0\neq ax\in\im\varphi$である．すると，ある$x_1\in M_1$が存在して$ax=\varphi(x_1)$とできる．$\psi(x)=0$と仮定すると，$0=a\psi(x)=\psi(ax)=\psi(\varphi(x_1))$であり$\psi\circ\varphi$が単射なので$x_1=0$となる．よって$ax=\varphi(0)=0$となりこれは矛盾．よって$\psi(x)\neq0$である．
\end{proof}

これをつかって，射影被覆と双対的に次が示される．

\begin{prop}\label{prop:入射包絡の一意性}
	$M$を$A$加群とし，入射包絡$\varepsilon:M\to I$が存在したとする．入射加群$I'$と単射$\varepsilon':M\to I'$について分裂単射$f:I\to I'$が存在して，次の図式；
	\[\begin{tikzcd}
		&&I\arrow[dd,"f"]\\[-1.5em]
		0\nxcell M\arrow[ur,"\varepsilon"]\arrow[dr,"\varepsilon'"]\\[-1.5em]
		&&I'
	\end{tikzcd}\]
	が可換（$I'$は$I$と同系な直和因子を持つ）．
\end{prop}

射影被覆と異なるのは入射包絡が必ず存在することである．

\begin{thm}[入射包絡の存在]
	$A$加群$M$について入射包絡が必ず存在する．
\end{thm}

\begin{proof}
	$A$加群の圏は入射的対象を十分に持つ（\ref{thm:加群の圏はhas enough injectives}）ので，入射加群$I$と単射$\varepsilon:M\to I$が存在する．次の集合；
	\[\mathscr{E}=\mkset{E:I\text{の部分加群}}{M\subset E, M\text{は}E\text{の本質部分加群}}\]
	は$M\in\mathscr{E}$なので空ではなく，帰納的順序集合をなす．よってZornの補題から極大元がとれ，それを$E$としよう．次に；
	\[\mathscr{L}=\mkset{L:I\text{の部分加群}}{L\cap E=0}\]
	は$0\in\mathscr{L}$より空でなく，帰納的順序集合をなすなので極大元を$L$とおく．埋め込み$\iota:E\to I$と自然な全射$\pi:I\to I/L$を考える．合成$\pi\circ\iota$は単射であり，$\pi(E)$は$I/L$で本質的．実際$L\subset N\subset I$を$I$の部分加群とすると，$\pi(E)\cap N/L=0$なら$E\cap N\subset L$だが$E\cap L=0$より$E\cap N=0$となり，$L$の極大性より$N=L$である．
	
	次に$E$は$\varphi(I/L)$の本質部分加群であることを示そう．$I$が入射的なので，次の図式；
	\[\begin{tikzcd}
	&&I\\
	0\nxcell E\arrow[ur,"\iota",hookrightarrow]\nxcell[\pi\circ\iota]I/L\arrow[u,dashed,"\varphi"]
	\end{tikzcd}\]
	が可換になる$\varphi:I/L\to I$が存在する．$\varphi(I/L)$の部分加群$N$について$E\cap N=0$であるとする．このとき$\pi(E)\cap\varphi^{-1}(N)=0$である．実際$x\in\pi(E)\cap\varphi^{-1}(N)$とすると，ある$y\in E$が存在して$\pi(y)=x$である．このとき$\varphi(\pi(y))=y\in N\cap E$より$y=0$であり，ゆえに$x=0$となる．すると$\pi(E)$は$I/L$の本質部分加群なので$\varphi^{-1}(N)=0$となり$N\subset\im\varphi$だから$N=0$となる．すると$E$は$M$の本質拡大で，$\varphi(I/L)$は$E$の本質拡大なので$\varphi(I/L)$は$M$の本質拡大だから（\ref{prop:本質的加群の判定条件}を用いて確かめよ）$E$の極大性より$E=\varphi(I/L)$である．よって$\iota:E\to I$は分裂単射となる．ゆえに$E$は入射加群であり，これが$M$の入射包絡にほかならない．
\end{proof}

この定理と\ref{prop:入射包絡の一意性}より$A$加群$M$の入射包絡は同型を除いて必ず一意に存在するので$\E(M)$とかくことにしよう．

\section{ホモロジー次元}
定義からホモロジー次元について次が従う．

\begin{lem}
	$A$を環，$M$を$A$加群とする．このとき；
	\begin{sakura}
		\item $\prjdim M\leq n$であるとき，任意の$i>n$と$A$加群$N$について$\Ext^{i}(M,N)=0$である．
		\item $\injdim M\leq n$であるとき，任意の$i>n$と$A$加群$N$について$\Ext^{i}(N,M)=0$である．
	\end{sakura}
	が成り立つ．
\end{lem}

この逆が成り立つだけでなく，\ref{prop:ホモロジー次元を抑える}により$n+1$についてのみ確かめればよいことがわかる．まず$\Ext$の長完全列を考えることにより次の補題が従うことを注意しておこう．

\begin{lem}
	$A$加群$P$が射影的であることと，任意の$A$加群$N$について$\Ext^1(P,N)=0$であることは同値．また$I$が入射的であることは任意の$N$について$\Ext^1(N,I)=0$であることと同値．
\end{lem}

\begin{proof}
	$P$についてのみ示す．$A$加群の完全列；
	\[\ses{M_1}{M_2}{M_3}\]
	から得られる$\Ext$の長完全列；
	\[\begin{tikzcd}
	0\nxcell\hom(P,M_1)\nxcell\hom(P,M_2)\nxcell\hom(P,M_3)\nxcell\Ext^1(P,M_1)\nxcell\cdots
	\end{tikzcd}\]
	を考えれば$\hom(P,-)$が完全関手であることと$\Ext^1(P,M_1)=0$が同値であることがわかる．
\end{proof}

これと全く同様にして，$A$加群$M$が平坦であることと，任意の$A$加群$N$について$\Tor_1(M,N)=0$であることが同値だとわかることを注意しておく．

\begin{prop}\label{prop:ホモロジー次元を抑える}
	$A$を環，$M$を$A$加群とする．このとき；
	\begin{sakura}
		\item $\prjdim M\leq n$であることと，任意の$A$加群$N$について$\Ext^{n+1}(M,N)=0$であることは同値．
		\item $\injdim M\leq n$であることと，任意の$A$加群$N$について$\Ext^{n+1}(N,M)=0$であることは同値．
	\end{sakura}
	が成り立つ．
\end{prop}

\begin{proof}
	(i)のみ示す．$(\Longrightarrow)$は明らかなので，逆を見ればよい．$M$の射影分解$P_\bullet$を考える．$P=\im d_n~(d_n:P_n\to P_{n-1})$とおくと，次の２つの完全列；
	\[\begin{tikzcd}
	0\nxcell P\nxcell P_{n-1}\nxcell[d_{n-1}]P_{n-2}\nxcell\cdots\nxcell P_0\nxcell M\nxcell0\end{tikzcd};\]
	\[\begin{tikzcd}
	\cdots\nxcell P_{n+1}\nxcell[d_{n+1}]P_n\nxcell[d_n]P\nxcell0
	\end{tikzcd}\]
	がある．１つめの完全列より，$P$が射影的ならば$\prjdim M\leq n$が従うので，これを示そう．２つめの完全列を$P$の射影分解とみなすと，$\Ext^1(P,N)=\Ext^{n+1}(M,N)=0$となっており，$P$は射影的である．
\end{proof}

同様にExtの長完全列を考えることで次の２つの命題がわかる．
\begin{cor}\label{cor:prjdimの有限性}
	$A$加群の完全列；
	\[\ses{M_1}{M_2}{M_3}\]
	について，２つの加群の射影元が有限なら残りの１つの射影次元も有限．
\end{cor}

\begin{cor}\label{cor:prjdim lemma}
	$A$加群の完全列；
	\[\ses{M_1}{M_2}{M_3}\]
	について，$\prjdim M_2<\infty$であるとき，$\prjdim M_1=\prjdim M_2$ならば$\prjdim M_3\leq\prjdim M_1+1$であり，$\prjdim M_1>\prjdim M_2$ならば$\prjdim M_3=\prjdim M_1+1$である．
\end{cor}

実際の計算において，Noether局所環$(A,\ideal{m},k)$の上の有限生成加群$M$について，長さが$\prjdim M$であるような（すなわち極小な）射影分解$P_\bullet$が同型を除いて一意的に存在することを示すことができる（\ref{thm:極小自由分解}）．それを証明するために，まずは一般の場合について少し考察してみよう．

\begin{lem}\label{lem:射影次元ステップアップ}
	$A$を環，$M$を射影的でない$A$加群とする．射影加群$P$と全射$\varepsilon:P\to M$について；
	\[\prjdim M=\prjdim \ker\varepsilon+1\]
	である．
\end{lem}

\begin{proof}
	$\prjdim M=n\geq1, K=\ker\varepsilon$とおく．任意の$A$加群$N$について，完全列；
	\[\ses{K}{P}{M}\]
	が誘導する$\Ext$の完全列（$i\geq0$）；
	\[\begin{tikzcd}
	\nxcell\Ext^i(P,N)\nxcell\Ext^i(K,N)\nxcell\Ext^{i+1}(M,N)\nxcell\Ext^{i+1}(P,N)=0\nxcell
	\end{tikzcd}\]
	について，$i>0$とすると$P$が射影的だから$\Ext^i(K,N)\cong\Ext^{i+1}(M,N)$がわかる．よって\ref{prop:ホモロジー次元を抑える}により$n=\infty$なら$\prjdim K=\infty$であるからよい．$n<\infty$のときは$i=n+1$とすれば$\prjdim K\leq n-1$がわかる．
	
	次に上の完全列を$i=0$の場合に考えると，全射；
	\[\Ext^0(K,N)=\hom(K,N)\to \Ext^1(M,N)\]
	が存在するから，すべての$i\geq0$について$\Ext^{i+1}(M,N)\neq0$ならば$\Ext^i(K,N)\neq0$である．
	さて$\prjdim M\not\leq n-1$なので$\Ext^n(M,N')\neq0$となる$A$加群$N'$が存在し，$i=n-1$とすれば$\Ext^{n-1}(K,N')\neq0$がわかる．よって$\prjdim K\not\leq n-2$であり，$\prjdim K=n-1$が成り立つ．
\end{proof}

この補題を繰り返し適用するには$\ker d_n$が射影的にならないような射影分解を構築する必要がある．そこで射影被覆の出番となる．

\begin{defi}[極小射影分解]\index{きょくしょうしゃえいぶんかい@極小射影分解}
	$A$を環とし，$M$を$A$加群とする．$M$の射影分解；
	\[\begin{tikzcd}
		\cdots\nxcell P_1\nxcell[d_1] P_0\nxcell[d_0]0
	\end{tikzcd}\]
	について，各$d_i:P_i\to\ker d_{i-1}$（$i=0$については全射$\varepsilon:P_0\to M$が射影被覆とし，$d=1$については$d_1:P_i\to\ker\varepsilon$が射影被覆とする）が射影被覆であるとき，これを\textbf{極小射影分解}(minimal projective resolution)であるという．
\end{defi}

射影被覆は存在すれば同型を除いて一意に定まるので，$M$の極小射影分解は存在すれば同型である．これが極小であることを示すために次の補題を用意する．
\begin{lem}
	$A$を環，$M$を射影的$A$加群とする．このとき，$M$の射影被覆$P$が存在すれば$M$と同型である．
\end{lem}

\begin{proof}
	全射$\varepsilon:P\to M$があり，$\ker\varepsilon$は$P$の余剰部分加群になっているとする．$M$は射影的なので，図式；
	\[\begin{tikzcd}
	M\arrow[d,"\varphi",dashed]\arrow[rd,"\id"]\\
	P\nxcell[\varepsilon]M\nxcell0 
	\end{tikzcd}\]
	を可換にする$\varphi:M\to P$があり，$\varepsilon$は分裂全射である．よって$P=\ker\varepsilon+M$であるが，射影被覆であったことから$P=M$となる．
\end{proof}

\begin{prop}
	$A$加群$M$について，$M$は射影的でないとする．$M$の極小射影分解$P_\bullet$が存在して，長さ$n$であるとする．このとき$\prjdim M=n$である．
\end{prop}

\begin{proof}
	まず，$\varepsilon:P_0\to M$は射影被覆である．$M$は射影的でないので，\ref{lem:射影次元ステップアップ}より；
	\[\prjdim M=\prjdim\ker\varepsilon+1\]
	である．さて，$d_1:P_1\to\ker\varepsilon$は射影被覆である．ここでもし$\ker\varepsilon$が射影的であるとすると，補題から$P_1=\ker\varepsilon$であり；
	\[\begin{tikzcd}
	0\nxcell P_1\nxcell P_0\nxcell[\varepsilon]M\nxcell0 
	\end{tikzcd}\]
	が完全となるので矛盾．ゆえに$\ker\varepsilon$は射影的でなく，\ref{lem:射影次元ステップアップ}から；
	\[\prjdim M=\prjdim \ker d_1+2\]
	である．これを続けていくと，$\prjdim \ker d_{n-2}=\prjdim \ker d_{n-1}+1$，すなわち；
	\[\prjdim M=\prjdim \ker d_{n-1}+n\]
	までは問題なく続けることができる．さて仮定から；
	\[\begin{tikzcd}
	0\nxcell P_n\nxcell[d_n]P_{n-1}\nxcell[d_{n-1}]\cdots 
	\end{tikzcd}\]
	は完全で，$P_n\cong\ker d_{n-1}$となる．すると$\ker d_{n-1}$は$0$でない射影加群だから$\prjdim\ker d_{n-1}=0$であり$\prjdim M=n$となることがわかった．
\end{proof}

もし長さが無限である（任意の$P_n$が$0$でない）ような極小射影分解が存在すれば，証明から\ref{lem:射影次元ステップアップ}を無限に適用できるので，この命題は$\prjdim M=\infty$の場合も成り立っている．これにより，極小射影分解を見つけることができれば$\prjdim M$を決定することができることがわかった．

いよいよNoether局所環という条件のもとで極小射影分解が存在することを示そう．

\begin{thm}[極小自由分解]\index{きょくしょうじゆうぶんかい@極小自由分解}\label{thm:極小自由分解}
	Noether局所環$(A,\ideal{m},k)$上の有限生成加群$M$の射影分解$P_\bullet$であって，次の条件；
	\begin{sakura}
		\item $P_\bullet$は極小射影分解である．
		\item 各$P_i$は有限生成な自由加群である．
		\item $P_0\otimes k=M\otimes k=M/\ideal{m}M$である．
	\end{sakura}
	をみたすものが存在する．これを$M$の\textbf{極小自由分解}(minimal free resolution)という．特に極小射影分解であるから，同型を除いて一意に定まる．
\end{thm}

\begin{proof}
	$M\otimes k=M/\ideal{m}M$の$k$ベクトル空間としての生成系$\{e_i\}$
	との代表元$u_i\in M$を固定し，$P_0=\oplus Ae_i$とおく．このとき，次の$A$準同型；
	\[\varepsilon:P_0\to M;e_i\mapsto u_i\]
	を考えると，これは全射である．実際$M=\im\varepsilon+\ideal{m}M$であることが容易に確かめられ，中山の補題より$M=\im\varepsilon$であることがわかる．またこれは射影被覆になる．これも$\ker\varepsilon\subset\ideal{m}P_0$であることに注意して中山の補題から従う．同様に$\ker\varepsilon$について射影被覆$d_1:P_1\to\ker\varepsilon$がとれる．これを繰り返して完全列；
	\[\begin{tikzcd}
	\cdots\nxcell P_2\nxcell[d_2]P_1\nxcell[d_1]P_0\nxcell[\varepsilon]M\nxcell0
	\end{tikzcd}\]
	を得，各$\ker d_i$は$P_i$の余剰部分加群である．よって$P_\bullet$を各$P_i$が自由でありかつ極小射影分解となっているようにとることができた．
\end{proof}

ここから射影次元を次のように言い換えることができる．

\begin{thm}\label{thm:射影次元の言い換え}
	$(A,\ideal{m})$をNoether局所環とし，$M\neq0$をその上の有限生成加群とする．このとき；
	\[\prjdim M=\sup\mkset{i\in N}{\Tor_i(M,A/\ideal{m})\neq0}\]
	である．
\end{thm}

ここから，ある$n\geq0$を固定したとき，ある$i\geq n$について$\Tor_i(M,A/\ideal m)\neq0$ならば$n\leq i\leq\prjdim M$であることがわかり，対偶をとって$\prjdim M<n$ならばすべての$i\geq n$について$\Tor_i(M,A/\ideal m)=0$である．これを一般化したものがホモロジカル予想の１つ，\textbf{剛性}(rigidty)\textbf{予想}である．

\begin{conj}[剛性予想]
	$(A,\ideal m)$を局所環とし，$M,N$を有限生成$A$加群とする．$\prjdim M<\infty$かつ$\Tor_n(M,N)=0$となる$n$が存在するならば，任意の$i\geq n$について$\Tor_i(M,N)=0$であろう．
\end{conj}

$A$が正則局所環のときには\cite{lichtenbaum1966}によって証明されている．その他いくつかの条件のもとでは成り立つことがわかっているが，一般には反例が存在する（\cite{heitmann1993counterexample}）．一方$\prjdim N<\infty$も仮定すると未解決である．

また，次のように驚くべき性質を示すことができる．

\begin{prop}\label{prop:Noether局所環上では自由なり射影なり同値}
	$(A,\ideal{m})$をNoether局所環とし，$M$をその上の加群とする．このとき，次の条件；
	\begin{sakura}
		\item $M$は自由である．
		\item $M$は射影的である．
		\item $M$は平坦である．
		\item $\Tor_1(A/\ideal m,M)=0$である．
	\end{sakura}
	は同値．
\end{prop}

\begin{proof}
	(iv)が(i)を導くことのみ見れば良い．極小自由分解の構成と同じように$\varepsilon:P_0\to M$を構成する．$\varepsilon$は全射であったので，$\Tor_1(A/\ideal m,M)=0$ならば$\ker\varepsilon=0$であることを示す．完全列；
	\[\ses{\ker\varepsilon}{P_0}{M}\]
	に$-\otimes A/\ideal m$を作用させて，Torの長完全列；
	\[\begin{tikzcd}
	\cdots\nxcell\Tor_1(A/\ideal m,M)\nxcell\ker\varepsilon\otimes A/\ideal{m}\nxcell P_0\otimes A/\ideal{m}\nxcell M\otimes A/\ideal{m}\nxcell0
	\end{tikzcd}\]
	を得る．$P_0$の構成から$P_0\otimes A/\ideal{m}=M\otimes A/\ideal{m}$であるので，$\Tor_1(A/\ideal m,M)=0$だから$\ker\varepsilon\otimes A/\ideal{m}=\ker\varepsilon/\ideal{m}\ker\varepsilon=0$である．よって中山の補題から$\ker\varepsilon=0$である．
\end{proof}

このようにNoether局所環上の有限生成加群では射影的であることと自由であることが同値になるが，Noether性という条件は外すことができる（それだけでなく有限生成である必要すらないが，長くなるのでここでは省く．\cite{matsu}をみよ）．

\begin{thm}
	$(A,\ideal{m})$を局所環，$M$を有限生成$A$加群とする．このとき，$M$が射影加群であることと自由加群であることは同値である．
\end{thm}

\begin{proof}
	$M$を射影加群とする．極小自由分解の構成から，有限生成自由加群$P_0$からの全射$\varepsilon:P_0\to M$が存在する．前命題と同様の議論から$\ker\varepsilon\otimes A/\ideal m=0$である（ここまでNoether性は要らず，$\ker\varepsilon$が有限生成であることにNoether性を使った）．ここで射影的であることと自由加群の直和因子であることは同値であったことと，その証明（\ref{thm:射影的と自由の直和因子は同値}）を思い出すと，$P_0\cong M\oplus\ker\varepsilon$であるので，とくに$\ker\varepsilon\cong P_0/M$であり，$P_0$は有限生成自由加群なので$\ker\varepsilon$も有限生成である．よって中山の補題が使えて$\ker\varepsilon=0$である．
\end{proof}

\begin{thm}[Auslander--Buchsbaumの公式]\index{#Auslander--Buchsbaumのこうしき@Auslander--Buchsbaumの公式}\label{thm:Auslander--Buchsbaumの公式}
	$(A,\ideal m)$をNoether局所環とし，$M\neq 0$をその上の射影次元有限な有限生成加群とする．このとき；
	\[\prjdim M+\mdepth M=\mdepth A\]
	が成り立つ．
\end{thm}

\begin{proof}
	$d=\mdepth A$とおく．$r=\prjdim M$についての帰納法で示す．$r=0$のとき，$M$は前定理より自由加群だから，$\mdepth M=\mdepth A$である．次に$1\leq r$とし，$r-1$まで成立しているとする．適当な$n$について全射$A^n\to M$が存在し，その核を$K$とおけば；
	\[\ses{K}{A^n}{M}\]
	が完全である．\ref{cor:prjdim lemma}より$\prjdim K=r-1$である．帰納法の仮定から$\mdepth K=d-r+1$である．よって$\mdepth M=d-r$を示せばよい．\ref{thm:Extとdepth}より$i<d-r+1$なら$\Ext^i(A/\ideal m,K)=0,\Ext^{d-r+1}(A/\ideal m,K)\neq0$である．上の完全列が導く$\Ext$の長完全列；
	\[\begin{tikzcd}
	\cdots\nxcell\Ext^i(A/\ideal m,A^n)\nxcell\Ext^i(A/\ideal m,M)\nxcell\Ext^{i+1}(A/\ideal m,K)\nxcell\Ext^{i+1}(A/\ideal m,A^n)\nxcell\cdots
	\end{tikzcd}\]
	を考えると，$i<d-r$ならば$i+1<d-r+1\leq d$なので；
	\[\begin{tikzcd}
	0\nxcell\Ext^i(A/\ideal m,M)\nxcell\Ext^{i+1}(A/\ideal m,K)\nxcell0
	\end{tikzcd}\]
	となり$\Ext^i(A/\ideal m,M)=\Ext^{i+1}(A/\ideal m,K)=0$である．また$i=d-r$のとき；
	\[\begin{tikzcd}
	0\nxcell\Ext^{d-r}(A/\ideal m,M)\nxcell\Ext^{d-r+1}(A/\ideal m,K)\nxcell\Ext^{d-r+1}(A/\ideal m,A^n)\nxcell\cdots
	\end{tikzcd}\]
	であり，$r>1$ならば$d-r+1<d$となり$\Ext^{d-r}(A/\ideal m,M)=\Ext^{d-r+1}(A/\ideal m,K)\neq0$である．
	
	$r=1$のときは別に示す必要がある．$M$の極小自由分解を考えて；
	\[\ses{P_1}{P_0}{M}\]
	とする．$\Ext^{d-1}(A/\ideal m,M)\neq0$を示す．
	\[\begin{tikzcd}
	0\nxcell\Ext^{d-1}(A/\ideal m,M)\nxcell\Ext^d(A/\ideal m,P_1)\nxcell\Ext^d(A/\ideal m,P_0)\nxcell\cdots
	\end{tikzcd}\]
	において$\Ext^d(A/\ideal m,P_1)\to\Ext^d(A/\ideal m,P_0)$を考える．$d_1:P_1\to P_0$において極小自由分解の構成から$\im d_1=\ker \varepsilon\subset\ideal{m}P_0$であったので，$P_1\to P_0$の誘導する$\hom(A/\ideal m,P_1)\to\hom(A/\ideal m,P_0)$は$0$である．ゆえに$\Ext^d(A/\ideal m,P_1)\to\Ext^d(A/\ideal m,P_0)$は$0$であり，上の完全列から$\Ext^{d-1}(A/\ideal m,M)=\Ext^d(A/\ideal m,P_1)\neq0$である．
	
	以上を組み合わせて証明が完了した．
\end{proof}

\section{大域次元とSerreの定理}

この節では，環の\textbf{大域次元}(global dimension)を導入して，Serreによる正則局所環の特徴づけとSerreの定理（\ref{prethm:Serre}）の証明を行おう．

\begin{defi}[大域次元]\index{たいいきじげん@大域次元}
	環$A$について；
	\[\gldim A=\sup\mkset{\prjdim M}{M:A\text{加群}}\]
	と定義する．これを$A$の\textbf{大域次元}(global dimension)という．
\end{defi}

大抵の環は$\gldim A=\infty$なので，大域次元が有限となる環に興味がある．先の命題を用いて大域次元は$A$のイデアルによる商環のみを確かめればよいことを示そう．

\begin{prop}[Auslander]
	$\gldim A=\sup\mkset{\prjdim A/I}{I:A\text{のイデアル}}$が成り立つ．
\end{prop}

\begin{proof}
	右辺を$n$とおく．明らかに$n\leq\gldim A$だから逆をみればよい．$n<\infty$としてよい．任意の$A$加群$N$について，$\Ext^{n+1}(A/I,N)=0$であるので，先の命題から$\injdim N\leq n$である．よって任意の$A$加群$M$について$\Ext^{n+1}(M,N)=0$であり，$\prjdim M\leq n$である．よって示された．
\end{proof}

Noether性を課すことでさらに話は簡単になる．

\begin{thm}\label{thm:Noether局所環の大域次元}
	$(A,\ideal{m})$をNoether局所環とする．このとき$\gldim A=\prjdim A/\ideal{m}$である．
\end{thm}

\begin{proof}
$\prjdim A/\ideal{m}=\infty$なら明らかであるので，有限であると仮定する．$n=\prjdim A/\ideal m$とおき，任意の$A$加群$M$について$\prjdim M\leq n$であることを，$\dim M$についての帰納法で示す．

$\dim M=0$とする．このとき$M$を$A/\ann M$加群とみると，$M$はNoetherかつArtin加群なので組成列；
\[0=M_0\subsetneq M_1\subsetneq\dots\subsetneq M_r=M\]
を持つ（\ref{prop:有限な組成列の同値条件}）．$A/\ann M$は唯一の極大イデアルを$\ideal{m}$とする局所環であるから，\ref{prop:単純加群の構造}により各$1\leq i\leq r$について$M_i/M_{i-1}\cong A/\ideal m$である．よって；
\[\ses{M_{i-1}}{M_i}{A/\ideal m}\]
が完全である．任意の$A$加群$N$について$\Ext^{n+1}(A/\ideal m,N)=0$であるので，$i=1$から順に考えて$\Ext^{n+1}(M,N)=0$である．よって$\prjdim M\leq n$である．

次に$d=\dim M>0$とし，$d-1$まで正しいと仮定する．まずは$\mdepth M>0$のときを考えると，$M$正則元$a\in\ideal m$が存在する．このとき$\dim M/aM=\dim M-1$である．よって帰納法の仮定から$\prjdim M/aM\leq n$である．次の完全列；
\[\ses[a\cdot]{M}{M}{M/aM}\]
が誘導するExtの長完全列を考えると，任意の$A$加群$N$について$\Ext^{n+1}(M/aM,N)=0$であり；
\[\begin{tikzcd}
	\Ext^n(M/aM,N)\nxcell\Ext^n(M,N)\nxcell[a\cdot]\Ext^n(M,N)\nxcell\Ext^{n+1}(M/aM,N)=0
\end{tikzcd}\]
から$a\Ext^n(M,N)=\Ext^n(M,N)$であるので，中山の補題から$\Ext^n(M,N)=0$である．よって$\prjdim M\leq n-1$である．

次に$\mdepth M=0$と仮定する．$L=\mkset{x\in M}{\text{ある}i\in\N\text{について}\ideal{m}^ix=0}$とおく．短完全列；
\[\ses{L}{M}{M/L}\]
を考えよう．まず$\dim L=0$であることを示す．$L$の生成系$\{u_1,\dots,u_r\}$をとる．各$i$について$\ideal{m}^{n_i}u_i=0$となる$n_i$がある．その最大値を$n$とすれば$\ideal{m}^n\subset\ann L$である．よって\ref{prop:局所環がm^n=0ならArtin}より$A/\ann L$はArtin，すなわち$\dim L=0$である．よって$\prjdim L\leq n$となる．また$M/L$について$\mdepth M/L>0$であることを示す．\ref{lem:depth 0とass}を局所環の場合に考えると$\mdepth M=0$であることと$\ideal m\in\ass M$であることは同値である．よって$\ideal m\not\in\ass M/L$であることを示そう．ある$x\in M$について$\ideal m=\ann (x+L)$であるとする．$\ideal m$の生成系$\{a_i\}$をとれば，任意の$i$について$a_i\ideal{m}^{n_i}x=0$となる$x_i$がとれるので，最大値を$n$として$\ideal{m}\cdot \ideal{m}^nx=\ideal{m}^{n+1}x=0$である．よって$x\in L$となる．ゆえに$\ideal m\not\in\ass M/L$となり，$\mdepth M/L>0$である．よって$\prjdim M/L\leq n-1$である．よって，$\Ext^{n+1}(M/L,N)=\Ext^{n+1}(L,N)=0$であるから$\Ext^{n+1}(M,N)=0$となり$\prjdim M\leq n$である．
\end{proof}

また，Auslander--Buchsbaumの公式（\ref{thm:Auslander--Buchsbaumの公式}）より容易に次の補題を得る．

\begin{lem}\label{lem:prjdim M/aM}
	$(A,\ideal{m})$をNoether局所環とし，$M$をそのうえの有限生成$A$加群とする．$M$正則元$a\in\ideal{m}$について；
	\[\prjdim M/aM=\prjdim M+1\]
	が成り立つ．
\end{lem}

\begin{proof}
	まず$\prjdim M=\infty$のときを考える．もし$\prjdim M/aM=n<\infty$ならば，短完全列；
	\[\ses[a\cdot]{M}{M}{M/aM}\]
	を考えて$\Ext^{n+1}(M/aM,N)=0$であるから，先の定理と同様に$\Ext^n(M,N)=0$となり仮定に反する．よって$\prjdim M/aM=\infty$となり仮定は成り立つ．
	
	次に有限個の場合を考えよう．$\prjdim M=n<\infty$とおく．\ref{cor:prjdimの有限性}より$\prjdim M/aM$も有限である．よってAuslander--Buchsbaumの公式から；
	\[\prjdim M/aM=\mdepth A-\mdepth M/aM=\mdepth A-(\mdepth A-1)=\prjdim M+1\]
	であることがわかる．
\end{proof}

また，$a\in\ideal m$が$A$正則という条件を足すことで$A/aA$加群としての射影次元を上から抑えることができる．

\begin{lem}\label{lem:prjdim_A/aA M/aM}
	$(A,\ideal{m})$をNoether局所環とし，$M$をそのうえの有限生成$A$加群とする．$M$正則元$a\in\ideal{m}$について$A$正則でもあるならば；
	\[\prjdim_{A/aA} M/aM\leq \prjdim_A M\]
	が成り立つ．
\end{lem}

\begin{proof}
	$d=\prjdim_A M$とおく．$d<\infty$と仮定してよい．$d$についての帰納法で示す．$d=0$のとき，$M$は自由なので$M\cong A^n$とすると$M/aM\cong(A/aA)^n$より$A/aA$加群として自由だから$\prjdim_{A/aA}M/aM=0$となり正しい．$d>1$とし，$d-1$まで正しいと仮定する．自由加群からの全射$\varphi:F\to M$を考えよう．次の図式；
	\[\begin{tikzcd}
		0\nxcell\ker\varphi\darrow[a\cdot]\nxcell F\darrow[a\cdot]\nxcell[\varphi]M\darrow[a\cdot]\nxcell0\\
		0\nxcell \ker\varphi\nxcell F\nxcell[\varphi]M\nxcell0
	\end{tikzcd}\]
	を考える．$a$は$M$正則だから$a\cdot:M\to M$は単射で，蛇の補題から；
	\[\ses{\ker\varphi/a\ker\varphi}{F/aF}{M/aM}\]
	が完全．\ref{cor:prjdim lemma}より$\prjdim\ker\varphi=d-1$だから，帰納法の仮定から$\prjdim_{A/aA}\ker\varphi/a\ker\varphi\leq d-1$である．再び\ref{cor:prjdim lemma}より$\prjdim_{A/aA}\ker\varphi/a\ker\varphi=\prjdim_{A/aA}M/aM-1$なので$\prjdim_{A/aA}M/aM\leq d-1+1=d$である．
\end{proof}


\ref{lem:prjdim M/aM}により次の定理が従う．

\begin{thm}[Auslander--Buchsbaum]
	$(A,\ideal m)$を$d$次元の正則局所環とすると，$\gldim A=d$である．
\end{thm}

\begin{proof}
	$x_1,\dots,x_d\in\ideal{m}$を正則巴系とすると，これは$A$正則列をなし$\prjdim A/\ideal m=\prjdim A+d=d$である．よって\ref{thm:Noether局所環の大域次元}より$\gldim A=\prjdim A/\ideal m=d$である．
\end{proof}

驚くべきはこれの逆が成り立つ．すなわち，局所環の大域次元が有限であることと正則であることは同値である．

\begin{thm}[Serre]
	$(A,\ideal m,k)$を$\gldim A=d<\infty$となるNoether局所環とする．このとき$A$は$d$次元の正則局所環である．
\end{thm}

\begin{proof}
	$d=\gldim A$とおく．また$r=\emdim A=\dim_k\ideal m/\ideal{m}^2$とおこう．まず$r=0$とする．$\ideal m=\ideal{m}^2$であるので，中山の補題から$\ideal m=0$である．よって$A$は体となり，$\gldim A=\prjdim A=0$なので題意が成り立つ．逆に$\gldim A=0$とすると，$\prjdim k=0$となり$k$は自由だから$k\cong A$となり，$A$は体となる．
	
	よって$r,d>0$と仮定してよい．$r$についての帰納法で示す．$r-1$まで正しいとしよう．$\ideal m\neq0$であり，中山の補題から$\ideal m\neq\ideal{m}^2$である．まず$a\in\ideal m\setminus\ideal{m}^2$を$A$正則にとれることを示す．任意の$a$が$A$正則でないと仮定する．すると$\ideal{m}\setminus\ideal{m}^2\subset\bigcup_{P\in\ass A}P$である．よって$\ideal m\subset\bigcup_{P\in\ass A}P\subset\ideal{m}^2$であるので，Prime avoidanceからある$P\in\ass A$について$\ideal{m}\subset P$である（$\ideal m\not\subset\ideal{m}^2$であるから）．$\ideal{m}$は極大なので$\ideal m\in\ass A$となり，単射$k\hookrightarrow A$が存在する（$\ideal m=\ann x$としたとき$a+\ideal m\mapsto ax$とすればよい）．よって短完全列；
	\[\ses{k}{A}{A/k}\]
	について，$\Tor_d(A,k)=\Tor_{d+1}(A,k)=0,\Tor_d(k,k)\neq0$だからTorの長完全列を考えて；
	\[\begin{tikzcd}
		0\nxcell\Tor_{d+1}(A/k,k)\nxcell\Tor_d(k,k)\nxcell0
	\end{tikzcd}\]
	が完全であり$\Tor_{d+1}(A/k,k)\neq0$となるので\ref{thm:射影次元の言い換え}より$d+1\leq\prjdim A/k$であるが，これは$d=\gldim A$であるので矛盾．
	
	このとき，$A/aA$が$\emdim A/aA=r-1$となる大域次元有限な環であることを示そう．$r=\dim_k \ideal m/\ideal{m}^2$であるので，$a_1,\dots,a_r\in\ideal m$を$a_i+\ideal{m}^2$が$\ideal m/\ideal{m}^2$の基底になるようにとれる．ここで$a_1=a$としてよい．$I=(a_2,\dots,a_r)$とおくと，中山の補題より$aA+I=\ideal m$であり，$\emdim A/aA=\dim_k (\ideal{m}/aA)/(\ideal{m}/aA)^2=r-1$である．また$\ideal m/aA=(aA+I)/aA\cong I/(I\cap aA)$である．ここで任意の$ab\in aA\cap I$をとると，ある$c_i\in A$により$ab=c_2a_2+\dots+c_ra_r$とかけている．よって$ba_1-c_2a_2-\dots-c_ra_r=0$である．これを$k$加群$\ideal m/\ideal{m}^2$におとすと，$a_i+\ideal{m}^2$は一次独立であるからすべての係数は$k$でゼロ，つまり$b,c_i\in\ideal{m}$でなければならない．よって$I\cap aA\subset a\ideal{m}$である．よって；
	\[\ideal m/a\ideal m\to\ideal m/aA=I/(I\cap aA)\to\ideal m/a\ideal m\]
	が恒等だから$\ideal m/a\ideal m\to \ideal m/aA$は分裂する．よって$\ideal m/aA$は$\ideal m/\ideal{m}^2$の直和因子である．ゆえに$\prjdim_{A/aA}\ideal m/aA\leq\prjdim_{A/aA}\ideal m/\ideal{m}^2$であり，\ref{lem:prjdim_A/aA M/aM}より；
	\[\prjdim_{A/aA} k-1=\prjdim_{A/aA}\ideal m/aA\leq\prjdim_A \ideal m=\prjdim_A k-1\]
	よって$\gldim A/aA<\infty$であり，帰納法の仮定から$A/aA$は正則である．ゆえに$\dim A/aA=r-1$となり，$\dim A=\dim A/aA+1$だから$A$も$r$次元の正則局所環である．
\end{proof}

これが可換環論にホモロジー代数を導入したことによる大結果の最初の１つである．この定理により次の定理がほぼ自明と化した．
\begin{thm}[Serreの定理]\index{#Serreのていり@Serreの定理}\label{thm:Serreの定理}
	$A$を正則局所環とすると，任意の$P\in\spec A$について$A_P$も正則局所環である．
\end{thm}

\begin{proof}
	前定理から$\prjdim_A A/P<\infty$であり，有限な極小自由分解を得る．これを$P$で局所化して$A_P/PA_P$の極小自由分解を得，$\prjdim_{A_P} A_P/PA_P<\infty$である．
\end{proof}

\section{UFDとAuslander--Buchsbaumの定理}

この節では有限自由分解と呼ばれる射影分解の一種をもつ加群について触れるとともに，Auslander--Buchsbaumの定理（\ref{prethm:Auslander-Buchsbaum}）の証明を与える．まずUFDについていくつかの性質を見ていこう．まず整域$A$がUFDであることと，単項イデアルについての昇鎖律を満たし，既約元が素元であることは同値である．前半の部分は元を無限に割り続けることはできないということ，後半の部分は分解の一意性を保証する．この節では単項イデアルについての昇鎖律を(ACCP)と略記する．まずよく知られている次の判定法を紹介しよう．

\begin{prop}\label{prop:UFD判定}
	Noether整域$A$がUFDであることはすべての高さ$1$の素イデアルが単項であることと同値である．
\end{prop}

\begin{proof}
	\begin{eqv}
		\item $P\in\spec A$が高さ$1$であるとする．任意の$0$でない$a\in P$について既約分解$a=f_1\cdots f_r$する．このときある$f_i$について$f_i\in (P)$であるから$(f_i)\subset P$であり，UFDにおいて既約元は素元だから$(f_i)\in\spec A$である．すると$\idht P=1$だから$(f_i)=P$である．
		\item 既約元は素元であることを示せばよい．$f$を既約元とする．$(f)$の極小素イデアル$P$について単項イデアル定理より$\idht P=1$である．よって$P$は単項だから$P=(a)$とかける．よって$f\in (a)$なのである$r$について$f=ar$であり，$f$は既約だから$r$は単元．よって$(f)=P$となり$f$は素元である．
	\end{eqv}
\end{proof}

また，Noetherと限らない一般の整域について次が成り立つ．

\begin{lem}
	$A$を整域とする．$S\subset A$を素元によって生成された積閉集合とする．$f\in A$を既約であるとする．このとき$f/1\in S^{-1}A$も既約であり，また$f$が素元であることと$f/1$が素元または単元であることは同値．
\end{lem}

\begin{proof}
	まず$f/1$が既約であることを示そう．$f/1=a/s\cdot b/t$とかけるとする．すると$stf=ab$とかける．$st\in S$なので，素元$p_1,\dots,p_n$をとって$st=p_1\cdots p_n$とかける．よって各$i$について$ab\in (p_i)$であるから，$a\in (p_i)$または$b\in (p_i)$である．よってある$r,r'\in A$と$s',s''\in S$がとれて$f=rr',a=s'r,b=s''r'$とかける．$f$は既約なので$r$または$r'$は単元である．よって$a\in S$または$b\in S$となり$a/s$または$b/t$は単元である．よって$f/1$は既約である．
	
	次に$f\in A$が素元であるとする．すると$S^{-1}A/(fS^{-1}A)=S^{-1}(A/fA)$において$A/fA$は整域であるから$S^{-1}(A/fA)$はゼロまたは整域である．よって$f/1$は素元または単元である．逆を示そう．まず$f/1$が単元であるとすると，$f/1\cdot a/s=1$となる$a/s\in S^{-1}A$が存在する．このとき$fa=s\in S$であるので，適当な$p_1,\dots,p_n$をとって$fa=p_1\cdots p_n$とかける．よって各$i$について$f\in (p_i)$または$a\in (p_i)$である．任意の$i$について$f\not\in (p_i)$ならば$f$は単元になり既約であることに矛盾．よって$f\in (p_i)$となる$i$があるが，$f$が既約なので$(f)=(p_i)$となり$f$は素元である．また$f/1$が素元であるとすると，$ab\in (f)$とすると$(f/1)$が素イデアルだからある$s\in S$と$r\in A$が存在して$sa=rf$または$sb=rf$である．$sa=rf$のときに示す．$s=p_1\cdots p_n$と表そう．このとき$rf\in (p_i)$より，ある$i$について$f\in (p_i)$なら$f$は素元であり問題ない．また任意の$i$について$f\not\in (p_i)$なら$a\in (f)$となり$(f)$が素イデアルであることが従う．
\end{proof}

\begin{thm}[永田の判定条件]\label{thm:UFDnagata}
	整域$A$についてUFDであることと，(ACCP)を満たし，かつある素元からなる$A$の積閉集合$S$について$A_S$がUFDであることは同値．
\end{thm}

\begin{proof}
	\begin{eqv}
		\item 任意の$f/s\in S^{-1}A$をとる．$f\in A$を既約分解して$f=f_1\dots f_n$とする．$A$はUFDだから$f_i$は素元なので，ある$m\leq n$について$f_1,\dots,f_m\in S,f_{m+1},\dots,f_n\not\in S$となるように並び替えることができる．すると；
		\[f/s=\frac{f_1\dots f_m}{s}\frac{f_{m+1}}{1}\dots\frac{f_n}{s}\]
		とかけ，補題から$f/s$は単元と素元の積でかけているので，$S^{-1}A$はUFDである．
		\item $f\in A$を既約元とする．補題より$f/1$は既約であり，$S^{-1}A$がUFDだから$f/1$は素元．すると再び補題より$f$は素元である．
	\end{eqv}
\end{proof}

\ref{prop:UFD判定}より素イデアルが単項かどうかに主要な興味があることがわかる．ここでは\cite{narita}による次の補題を紹介しよう．

\begin{lem}\label{lem:安定して自由でrank1なら単項}
	$A$が整域であるとする．イデアル$I$で$I\oplus A^n\cong A^{n+1}$となるものは単項イデアルである．
\end{lem}

\begin{proof}
	$A^{n+1}$の基底を$\{e_0,\dots,e_n\}$とする．また$I\oplus A^n\hookrightarrow A\oplus A^{n}$としたとき，$f_0$を$A$の，$\{f_1,\dots,f_n\}$を$A^n$の基底とすれば，同型；
	\[\varphi:A^{n+1}\to I\oplus A^n\]
	の基底による表現は$\varphi(e_i)=\sum_{j=0}^n a_{ij}f_j$とかける．行列$(a_{ij})$の$(i,0)$余因子を$d_i$とおき，$\det (a_{ij})=d$とすると，$\sum a_{i0}d_i=d,\sum a_{ij}d_i=0~(j\neq i)$である．よって$e_0'=\sum d_ie_i$とおくと$\varphi(e_0')=df_0$であり，$\varphi$は全射だから$\varphi(e_i')=f_i$となる$e_i'\in A^{n+1}$が存在する．ここで$e_i'=\sum_{j=0}^n c_{ij}e_j$とおくと，行列として；
	\[(c_{ij})(a_{ij})=
		\begin{pmatrix}
			d&0&\cdots&0\\
			0&1&&0\\
			\vdots&&\ddots\\
			0&0&&1
	\end{pmatrix}\]
	が成り立つ（$e_i'=\sum_{j=0}^n c_{ij}e_j$の両辺に$\varphi$を施してみよ）．よって$\det (c_{ij})=1$となるので，$e_0',\dots,e_n'$は$A^{n+1}$の基底である．ゆえに$If_0=\varphi(Ae_0')=Ad f_0$となり，$I=Ad$である．
\end{proof}
この補題の条件は一般に\textbf{安定して自由}であるといわれる．

\begin{defi}[安定して自由]
	$A$を環，$M$を$A$加群とする．有限自由加群$F,F'$が存在して$M\oplus F\cong F'$となるとき，$M$は\textbf{安定して自由}(stably free)であるという．
\end{defi}

加群が安定して自由であることを判定する条件として，\textbf{有限自由分解}が有効である．
\begin{defi}[有限自由分解]\index{ゆうげんじゆうぶんかい@有限自由分解}
	$A$を環，$M$を$A$加群とする．長さ有限の完全列；
	\[\begin{tikzcd}
		0\nxcell F_n\nxcell F_{n-1}\nxcell\dots\nxcell F_0\nxcell M\nxcell 0
	\end{tikzcd}\]
	であって，各$F_i$が有限階数の自由加群であるものが存在するとき，$M$は\textbf{有限自由分解}(finite free resolution)を持つという．
\end{defi}

まず，\ref{prop:射影被覆が同型の補題}の一般化であるSchanuelの補題を紹介しよう．
\begin{lem}[Schanuelの補題]\index{#Schanuelのほだい@Schanuelの補題}
	$A$を環，$M$を$A$加群とする．完全列；
	\[\begin{tikzcd}
		0\nxcell K\nxcell P_n\nxcell\dots\nxcell P_0\nxcell[\varepsilon] M\nxcell0\\
		0\nxcell K'\nxcell Q_n\nxcell\dots\nxcell Q_0\nxcell[\varepsilon'] M\nxcell0
	\end{tikzcd}\]
	について，各$0\leq i\leq n$について$P_i,Q_i$が射影加群ならば；
	\[P_0\oplus Q_1\oplus P_2\oplus\dots\cong Q_0\oplus P_1\oplus Q_2\oplus\dots\]
	が成り立つ．
\end{lem}

\begin{proof}
	$n$についての帰納法で示す．まず$n=0$とする．
	\[\begin{tikzcd}
		0\nxcell K\nxcell P\arrow[d,shift right=.5em,"g",swap]\nxcell[\varepsilon]M\nxcell0\\
		0\nxcell K'\nxcell Q\arrow[u,shift right=.5em, "f",swap]\nxcell[\varepsilon']M\nxcell0
	\end{tikzcd}\]
	$P,Q$は射影的なので，上のように$f,g$が存在して$\varepsilon'\circ f=\varepsilon,\varepsilon\circ g=\varepsilon'$が成り立つ．そこで同型写像$\varphi,\psi:P\oplus Q\to P\oplus Q$を構成しよう；
	\[\begin{tikzcd}
	0\nxcell K\oplus Q\nxcell P\oplus Q\arrow[d,shift right=.5em,"\varphi",swap]\nxcell[\widetilde\varepsilon]M\nxcell0\\
	0\nxcell K'\oplus P\nxcell P\oplus Q\arrow[u,shift right=.5em, "\psi",swap]\nxcell[\widetilde\varepsilon']M\nxcell0
	\end{tikzcd}\]
	$\varepsilon$を$P\oplus Q$に誘導した$(x,y)\mapsto \varepsilon(x)$を$\widetilde\varepsilon$と表す．$\varepsilon'$についても同様である．このとき；
	\[\varphi:P\oplus Q\to P\oplus Q;(x,y)\mapsto (x-g(y),y+f(x-g(y)))\]
	と定義する．同様に；
	\[\psi:P\oplus Q\to P\oplus Q;(x,y)\mapsto(x+g(f(x)-y),y-f(x))\]
	と定義すれば$\psi=\varphi^{-1}$となる．また$\widetilde\varepsilon'\circ\varphi=\widetilde\varepsilon$であり，誘導される$K\oplus Q\to K'\oplus P$について蛇の補題から同型であることがわかる．
	
	$n-1$まで正しいとしよう．次の完全列；
	\[\begin{tikzcd}
	0\nxcell K\nxcell P_n\nxcell\dots\nxcell P_1\nxcell\ker\varepsilon \nxcell0\\
	0\nxcell K'\nxcell Q_n\nxcell\dots\nxcell Q_1\nxcell\ker\varepsilon'\nxcell0
	\end{tikzcd}\]
	について，$n=0$の場合から$\ker\varepsilon\oplus Q_0\cong\ker\varepsilon'\oplus P_0$であり，次の完全列；
	\[\begin{tikzcd}
	0\nxcell K\nxcell P_n\nxcell\dots\nxcell P_1\oplus Q_0\nxcell\ker\varepsilon\oplus Q_0\arrow[d,"\cong"] \nxcell0\\
	0\nxcell K'\nxcell Q_n\nxcell\dots\nxcell Q_1\oplus P_0\nxcell\ker\varepsilon'\oplus P_0\nxcell0
	\end{tikzcd}\]
	に$n-1$の場合を適用して結論を得る．
\end{proof}

\begin{prop}
	有限生成な射影加群が有限自由分解をもてば安定的に自由である．
\end{prop}

\begin{proof}
	$P$を有限生成な射影加群とする．
	\[\begin{tikzcd}
		0\nxcell F_n\nxcell\dots\nxcell F_0\nxcell P\nxcell0\\
		0\nxcell 0\nxcell\dots\nxcell P\nxcell[\id] P\nxcell0
	\end{tikzcd}\]	
	についてSchanuelの補題を適用すればよい．
\end{proof}

これらの準備を踏まえていよいよAuslander--Buchsbaumの定理を証明しよう．
\begin{thm}[Auslander--Buchsbaumの定理]\index{#Auslander--Buchsbaumのていり@Auslander--Buchsbaumの定理}\label{thm:Auslander--Buchsbaumの定理}
	正則局所環はUFDである．
\end{thm}

\begin{proof}
	正則局所環$(A,\ideal{m})$について，$\dim A=d$の帰納法で示す．$d=0,1$のときは体，DVRでありUFDである．$d>1$としよう．$x\in \ideal{m}$を正則巴系の１部分とすると，\ref{prop:正則局所環は落ちる}により$A/xA$は正則局所環，特に整域である．ゆえに$x$は素元であるので，\ref{thm:UFDnagata}により$A_x$がUFDであることを示せばよい．
	
	$R=A_x$とおき，$P'\in\spec R$で$\idht P'=1$であるものをとる．まず$P'$が射影的であることを示す．$R$の極大イデアル$\ideal{m}'$を任意にとる．このとき$Q=\ideal{m}'\cap A$とおくと，$x\not\in Q$であり$R_{\ideal{m}'}=A_Q$である．Serreの定理により$R_{\ideal{m}'}$は正則であり，また$Q\subsetneq\ideal{m}$から$\dim A_Q<d$であるから，帰納法の仮定より$R_{\ideal{m}'}$はUFDである．すると$P'\subset\ideal{m}'$なら$P'R_{\ideal{m}'}$は単項であり，$P'\not\subset\ideal{m}'$なら$P'R_{\ideal{m}'}=R_{\ideal{m}'}$である．よって常に$P'R_{\ideal{m}'}\cong R_{\ideal{m}'}$であるから，$P'R_{\ideal{m}'}$は射影的$R_{\ideal{m}'}$加群である．よって\ref{prop:射影加群は局所的}から$P'$は射影的$R$加群である．
	
	次に$P=P'\cap A$とおく．$A$は正則局所環なので$P$は有限自由分解を持ち，よって$P'$も有限自由分解を持つ．$P'$は射影加群だったから先の命題より安定して自由である．よって\ref{lem:安定して自由でrank1なら単項}により$P'$は単項イデアルとなり，$A_x$はUFDであることがわかった．
\end{proof}

\begin{cor}
	正則局所環は整閉整域である．
\end{cor}
\section{Serreの条件}

前節ではAuslander--Buchsbaumの定理を証明し，その系として正則局所環は整閉整域であることを結論づけた．この節ではAuslander--Buchsbaumの定理を用いることなく，別証明を与えよう．

\begin{defi}[Serreの条件]\index{#Serreのじょうけん@Serreの条件}
	$A$をNoether環とする．
	\begin{sakura}
		\item 任意の$\idht P\leq n$となる$P\in\spec A$について$A_P$が正則局所環であるとき，$A$で$(R_n)$が成り立つという．
		\item 任意の$P\in\spec A$について$\min\{n,\idht P\}\leq\mdepth A_P$となるとき，$A$で$(S_n)$が成り立つという．
	\end{sakura}
\end{defi}

$(R_n)$についてはわかりやすい条件であるから，$(S_n)$について少し見てみよう．明らかに$A$で$(S_{n+1})$が成り立つならば$(S_n)$が成り立つ．また，次を確認することも容易いだろう．

\begin{prop}
	Noether環$A$がCM環であることと，任意の$n$について$(S_n)$が成り立つことは同値．
\end{prop}

また，次の言い換えが成り立つ．
\begin{lem}
	Noether環$A$について$(S_1)$が成り立つことと，任意の$P\in\ass A$が極小であることは同値である．
\end{lem}

\begin{proof}
	任意の$P\in\ass A$をとる．このとき\ref{lem:素因子と局所化}より$PA_P\in\ass A_P$である．すると\ref{lem:depth 0とass}により$\mdepth A_P=0$である．よって$\min\{1,\idht P\}\leq0$だから$\idht P=0$となる．逆はこれを反対方向にたどればよい．
\end{proof}

まず，これを用いた被約性の判定法を紹介しよう．

\begin{thm}[Serreの$(R_0)+(S_1)$判定法]
	Noether環$A$について$(R_0),(S_1)$が成り立つことと$A$が被約であることは同値である．
\end{thm}

\begin{proof}
	\begin{eqv}
		\item $\nil A=\bigcap_{\idht P=0}P=0$であることを示す．$\ass A=\{P_1,\dots,P_r\}$とおき，$0$を準素分解して$0=Q_1\cap\dots\cap Q_r$とする．ここで$Q_i$は$P_i$準素イデアルとする．$(S_1)$より$\ass A=\mkset{P\in\spec A}{\idht P=0}$であることに注意すると，局所化$f_i:A\to A_{P_i}$について\ref{thm:準素成分の一意性}より$Q_i=f_i^{-1}(0)$である．ここで$(R_0)$から$A_{P_i}$は$0$次元の正則局所環，すなわち体である．よって$Q_i=P_i$となる．ゆえに$\bigcap_{\idht P=0}P=Q_1\cap\dots\cap Q_r=0$であるので，$A$は被約． 
		\item $0=\bigcap_{\idht P=0}P$が$0$の準素分解となり，$\ass A=\mkset{P\in\spec A}{\idht P=0}$となるので$(S_1)$が成り立つ．また，$P'\in\ass A$が$P\neq P'$ならば$P'A_P=A_P$であるから；
		\[0=\bigcap_{\idht P'=0}P'A_P=PA_P\]
		となる．よって$A_P$は体となり，$(R_0)$が成り立つ．
	\end{eqv}
\end{proof}

次に$(S_2)$についてみてみよう．以下\textbf{仮定に整域を課す}ことに注意せよ．

\begin{lem}
	$A$をNoether整域とする．$(S_2)$が成り立つことと，任意の$a\in A$で$0$でも単元でもないものについて，任意の$P\in\ass A/aA$は高さ$1$であることは同値である．
\end{lem}

\begin{proof}
	\begin{eqv}
		\item 任意の$P\in\ass A/aA$をとる．$a/1\in PA_P$は$A_P$正則である．$P=\ann (x+aA)$とおくと，任意の$b/1\in PA_P$について$bx/1=0\in A_P/aA_P$であるので$A_P/aA_P$正則元は存在しない．よって$\mdepth A_P=1$である．ゆえに$(S_2)$から$\min\{2,\idht P\}\leq1$であるから$\idht P\leq1$である．一方Krullの単項イデアル定理から$1\leq\idht P$なので，$\idht P=1$である．
		\item $\idht P=0,1$のときは明らかに$\idht P\leq\mdepth A_P$が成り立つ．$2\leq\idht P$のときを考えればよい．$0\neq a_1\in P$を１つ固定する．任意の$a_2\in P$が$A/aA$の非正則元であるなら，$P\subset\bigcup_{Q\in\ass A/a_1A}$であるのでPrime avoidanceにより$P\subset Q$となる$Q\in\ass A/a_1A$が存在する．ここで仮定より$Q$は高さ1なので$\idht P\leq1$となって矛盾する．よって$A/a_1A$正則元$a_2\in P$が存在し，$2\leq\mdepth A_P$である．
	\end{eqv}
\end{proof}

\begin{thm}[Serreの$(R_1)+(S_2)$判定法]
	Noether整域$A$が整閉であることと，$A$で$(R_1),(S_2)$が成り立つことは同値である．特に次の条件；
	\begin{sakura}
		\item $A$は整閉である．
		\item $A$について$(R_1),(S_2)$が成り立つ．
		\item $A$について$(R_1)$が成り立ち，$A=\bigcap_{\idht P=1}A_P$である．
	\end{sakura}
	は同値である．
\end{thm}

\begin{proof}
	\begin{eqv}[3]
		\item $(R_1)$が成り立つことは明らかである（整閉整域は正規であって，またDVRとは$1$次元の正則局所環のことであるから）．また，$0$でも単元でもない$a\in A$について$P\in\ass_A (A/aA)$を考える．$P=\ann (b+aA)$となる$b\not\in aA$をとろう．定義より$bP\subset aA$である．$P$で局所化して考えよう．$bPA_P\subset aA_P$であるから，$b/aPAP\subset A_P$である．ここで$b/aPA_P\subset PA_P$なら，Cayley--Hamiltonの定理より$b/a$は$A_P$上整である．よって$b/a\in A_P$となるが，これはある$s\not\in P$が$bs\in Aa$となることを導き矛盾．ゆえに$b/aPA_P=A_P$である．よって$bPA_P=aA_P$となり，ある$x\in P$と$s\not\in P$によって$bx/s=a$である．このとき任意の$c/t\in PA_P$について，ある$r/u\in A_P$が存在して$bc/t=ar/u=bxr/su$となる．$A$は整域だから$c/t=xr/su$が成立する．よって$PA_P=xA_P$となり，極大イデアルが単項だから$A_P$は$1$次元である．よって$\idht P=1$となり，$(S_2)$が成り立つことがわかった．
		\item $A\subset\bigcap_{\idht P=1}A_P$は明らかであるから，$x/s\in\Frac A$について$x/s\in\bigcap_{\idht P=1} A_P$かつ$x/s\not\in A$であると仮定する．$x\not\in sA$かつ$s$は$A$の非単元であることに注意する．すると$A/sA$を$A$加群とみたとき$\ann (x+sA)$は$A$の真のイデアルであるから，$s\in\ann(x+sA)\subset P$となる$P\in\ass (A/sA)$が存在する．すると，先の補題より$(S_2)$から$\idht P=1$が従う．よって$x/s\in A_P$なのである$a\in A$と$t\not\in P$が存在して$x/s=a/t$となるが，定義よりある$h\not\in P$が存在して$h(xt-as)=0$となる．$A$は整域なので$xt=as\in sA$となり，$t\in\ann(x+sA)\subset P$となって矛盾する．よって$x/s\in A$である．
		\item $a/b\in\Frac A$について$A$上整であると仮定する．よって，$A$の元たちを適当にとれば；
		\[(a/b)^n+c_1(a/b)^{n-1}+\dots+c_n=0\quad(c_i\in A)\]
		となる$n$が存在する．このとき，仮定から$c_i$たちは整閉整域$A_P$の元であるから，$a/b$は$A_P$上整となり$a/b\in A_P$である．これが任意の$\idht P=1$となる$P$で言えるから$a/b\in\bigcap_{\idht P=1}A_P=A$である．
	\end{eqv}
\end{proof}

この事実により，Auslander--Buchsbaumの定理を経由することなく次が示される．
\begin{cor}
	正則局所環は整閉整域である．
\end{cor}

\begin{proof}
	正則だから$(R_1)$は明らかになりたち，またCM環であるので$(S_2)$も成り立つ．
\end{proof}

\section{Noether局所環上の入射次元とGorenstein環}

この節では，Noether局所環についての入射次元について考察し，CM環のうちでも重要なクラスをなす\textbf{Gorenstein環}を定義しよう．
\begin{defi}[Gorenstein環]\index{#Gorensteinかん@Gorenstein環}
	Noether局所環$(A,\ideal m)$について$\injdim A<\infty$であるとき，$A$は\textbf{Gorenstein局所環}であるという．一般のNoether環$A$については，任意の$P\in\spec A$について$A_P$がGorensteinのとき$A$は\textbf{Gorensitein環}であるという．
\end{defi}

\ref{prop:ホモロジー次元を抑える}を入射次元についてより簡単に書き換えるところから始めよう．

\begin{prop}\label{prop:injdimのイデアルによる判定}
	$A$を環，$M$を$A$加群とする．このとき，与えられた$n$について$\injdim M\leq n$であることと，任意の$A$のイデアル$I$について$\Ext^{n+1}_A(A/I,M)=0$であることは同値．
\end{prop}

\begin{proof}
	$A$加群$M$が入射的であることと，任意の$A$のイデアル$I$について$\Ext^1(A/I,M)=0$であることが同値であることを示せば十分である．$M$が入射的なら$\Ext^1$が消えることは明らかなので，逆を見ればよい．Bearの基準（\ref{thm:Bear's Criterion}）より，$\hom(-,M)$が自然な$0\to I\to A$の完全性を保てばよい．それは完全列；
	\[\ses{I}{A}{A/I}\]
	に対して$\hom(-,M)$が導く長完全列；
	\[\begin{tikzcd}
	0\nxcell \hom(A/I,M)\nxcell\hom(A,M)\nxcell\hom(I,M)\nxcell\Ext^1(A/I,M)=0\nxcell\cdots
	\end{tikzcd}\]
	より成り立つことがわかり，$M$は入射的である．
\end{proof}

これをNoether環の場合に拡張しよう．

\begin{prop}\label{prop:Noetherのinjdim判定法}
	$A$をNoether環とし，$M$を$A$加群とする．このとき，与えられた$n$について$\injdim M\leq n$であることと，任意の$P\in\spec A$について$\Ext^{n+1}(A/P,M)=0$であることは同値．
\end{prop}

\begin{proof}
	$(\Longrightarrow)$は明らか．任意のイデアル$I$について$\Ext^{n+1}(A/I,M)=0$を示せばよい．\ref{thm:Assは有限}の証明から，増大列；
	\[0=N_0\subsetneq N_1\subsetneq\dots\subsetneq N_r=A/I\]
	で，各$i$について$N_{i+1}/N_i\cong A/P_i$となる$P_i\in\spec A$が存在するものがとれる．これから$\Ext^{n+1}(A/P_i,M)=0$により$\Ext^{n+1}(A/I,M)=0$となることがわかり，題意が従う．
\end{proof}

この証明から次の補題を定式化することができる．

\begin{lem}
	$A$をNoether環とし，$M$を$A$加群，$N$を有限生成$A$加群とする．与えられた$n$について，任意の$P\in\supp N$について$\Ext^n(A/P,M)=0$ならば$\Ext^n(N,M)=0$である．
\end{lem}

\begin{lem}
	$(A,\ideal{m})$をNoether局所環とする．$\ideal{m}\neq P\in\spec A$と有限生成$A$加群$M$について，任意の$P\neq Q\in\ V(P)$に対して$\Ext^{n+1}(A/Q,M)=0$ならば$\Ext^n(A/P,M)=0$である．
\end{lem}

\begin{proof}
	任意の$a\in\ideal{m}\setminus P$をとる．このとき；
	\[\ses[a\cdot]{A/P}{A/P}{A/(P+aA)}\]
	が完全である．よって；
	\[\begin{tikzcd}
		\Ext^n(A/P,M)\nxcell[a\cdot]\Ext^n(A/P,M)\nxcell\Ext^{n+1}(A/(P+aA),M)
	\end{tikzcd}\]
	が誘導される．ここで$V(P+aA)\subset V(P)\setminus\{P\}$であるから，仮定と補題により$\Ext^{n+1}(A/(P+aA),M)=0$である．ゆえに中山の補題から$\Ext^n(A/P,M)=0$となる．
\end{proof}

\begin{thm}\label{thm:Noether局所環上の入射次元}
	$(A,\ideal{m},k)$をNoether局所環とし，$M$を有限生成$A$加群とする．このとき；
	\[\injdim M=\sup\mkset{i\in\N}{\Ext^i(k,M)\neq0}\]
	である．
\end{thm}

\begin{proof}
	$n=\sup\mkset{i\in\N}{\Ext^i(k,M)\neq0}$とおこう．$n\leq\injdim M$は明らかである．逆を示そう．任意の$P\in\spec A$をとる．また$\coht P=d$とし；
	\[P=P_0\subsetneq\cdots\subsetneq P_d=\ideal{m}\]
	を考える．ここで$\Ext^{n+d+1}(k,M)=0$なので，補題から$\Ext^{n+d}(A/P_{d-1},M)=0$である．次に，構成から同様に$P_{d-2}\subsetneq Q\subsetneq \ideal{m}$となる$Q$について$\Ext^{n+d}(A/Q,M)=0$なので，補題から$\Ext^{n+d-1}(A/P_{d-2},M)=0$である．これを繰り返して$\Ext^{n+1}(A/P,M)=0$となる．よって\ref{prop:Noetherのinjdim判定法}より$\injdim M\leq n$である．
\end{proof}

\begin{lem}\label{lem:A/aAのExt}
	$A$を環とし，$M$を$A$加群とする．$M$正則元$a\in A$について$A$正則でもあるならば，$aN=0$となる任意の$A$加群$N$について；
	\[\Ext^{i+1}_A(N,M)\cong\Ext^i_{A/aA}(N,M/aM)\]
	である．
\end{lem}

\begin{proof}
	まず$\hom(N,M)=0$である．実際$f:N\to M$について$af(N)=f(aN)=0$より，$a$が$M$正則だから$f(N)=0$である．さて，$F^n(-)=\Ext^{n+1}_{A}(-,M)$とおく．これが$\hom_{A/aA}(-,M/aM)$の導来関手に一致することを示そう．\ref{thm:右導来}のそれぞれの条件を示せばよい．
	
	\begin{sakura}
		\item 
			完全列；
			\[\ses[a\cdot]{M}{M}{M/aM}\]
			から；
			\[\begin{tikzcd}
				\hom_A(N,M)=0\nxcell\hom_A(N,M/aM)\nxcell\Ext^1_A(N,M)\nxcell[a\cdot]\cdots
			\end{tikzcd}\]
			が誘導され，\ref{lem:ExtのAnn}により$a\cdot$は$0$なので$F^0(N)=\Ext^1_A(N,M)=\hom_A(N,M/aM)=\hom_{A/aA}(N,M/aM)$である．
		\item 明らか．
		\item 明らか．
		\item 
			$a$が$A$正則なので；
			\[\ses[a\cdot]{A}{A}{A/aA}\]
			から$\prjdim A/aA=1$である．よって$n>0$について$\Ext^n_A(A/aA,M)=0$だからすべての$A/aA$自由加群$F$について$\Ext^n_A(F,M)=0$である．ゆえに任意の$A/aA$射影加群$P$は自由加群の直和因子だから$\Ext^n_A(P,M)=0$である．
	\end{sakura}
\end{proof}

\ref{thm:Noether局所環上の入射次元}と上の補題から次の定理を得る．
\begin{thm}\label{thm:injdim A/aA=injdim A-1}
	$(A,\ideal{m},k)$をNoether局所環，$M$を有限生成$A$加群とする．$M$正則元$a\in\ideal{m}$について$A$正則でもあるならば；
	\[\injdim_{A/aA}(M/aM)=\injdim_A M-1\]
	である．
\end{thm}
%\begin{lem}
%	$(A,\ideal{m},k)$をNoether局所環とする．$M$を有限生成$A$加群，$P\in\spec A$とする．
%	\[P=P_0\subsetneq P_1\subsetneq\dots\subsetneq P_d=\ideal{m}\]
%	となる素イデアル鎖が存在するならとき，$\Ext^i_{A_P}(A_P/PA_P,M_P)\neq 0$ならば$\Ext^{i+d}_A(k,M)\neq0$である．
%\end{lem}
%
%\begin{proof}
%	あらかじめ素イデアル鎖を飽和させておく．まず$P\subsetneq\ideal{m}$であり，間に素イデアルが存在しないときに示す．対偶を考えて$\Ext_A^{i+1}(k,M)=0$を仮定しよう．任意の$a\in\ideal{m}\setminus P$をとる．このとき；
%	\[\ses[a\cdot]{A/P}{A/P}{A/(P+aA)}\]
%	が完全である．また$P\subsetneq P+aA\subset\ideal{m}$なので，$A/(P+aA)$はArtinである．よって組成列を持ち，$\Ext^{i+1}_A(A/(P+aA),M)=0$であることがわかる．よって；
%	\[\begin{tikzcd}
%		\Ext^i_A(A/P,M)\nxcell[a\cdot]\Ext^i_A(A/P,M)\nxcell0
%	\end{tikzcd}\]
%	が完全であり，中山の補題から$\Ext^i_A(A/P,M)=0$である．よって$P$で局所化して$\Ext^i_{A_P}(A_P/PA_P,M_P)=0$である．これを$P_{d-1}\subsetneq P_d$に適用して$\Ext^{i+d-1}_{A_P}(A_P/PA_P,M_P)=0$となり，繰り返して結論を得る．
%\end{proof}

これらの準備により，次の結果を示すことができる．

\begin{thm}\label{thm:Gorensteinのinjdim}
	$(A,\ideal{m},k)$をNoether局所環とする．$A$がGorenstein，すなわち$\injdim A<\infty$ならば$\injdim A=\dim A$である．
\end{thm}

\begin{proof}
	$\injdim A=r,\dim A=d$とおく．$P\in\spec A$を；
	\[P=P_0\subsetneq P_1\subsetneq\dots\subsetneq P_d=\ideal{m}\]
	となるようにとる．このとき$P$は極小だから$PA_P\in\ass_{A_P}A_P$で，$\mdepth_{A_P}A_P=0$である．よって$\hom_{A_P}(A_P/PA_P,A_P)\neq0$であるから，ここで$\Ext^d_A(k,A)=0$ならば\ref{thm:Noether局所環上の入射次元}の証明から$\hom_A(A/P,A)=0$となり矛盾する．よって$\Ext^d_A(k,A)\neq0$であり，$d\leq r$である．逆を$r$についての帰納法で示そう．$r=0$のとき$d=r=0$となり明らかなので，$r>0$とする．このとき\ref{thm:Noether局所環上の入射次元}より$\Ext^r(k,A)\neq0$である．また$\mdepth A>0$である．実際$\mdepth A=0$なら$\ideal{m}\in\ass A$で，単射$k\to A$がある．すると$\injdim A=r$であるから完全列；
	\[\begin{tikzcd}
		\Ext^r(A,A)\nxcell\Ext^r(k,M)\nxcell0
	\end{tikzcd}\]
	が誘導され，また$A$自身が射影的であるから$\Ext^r(A,A)=0$である．よって$\Ext^r(k,M)=0$となり矛盾し，$\mdepth A>0$であることがわかった．よって$A$正則元$a\in\ideal{m}$がとれる．そこで\ref{thm:injdim A/aA=injdim A-1}より$\injdim_{A/aA}A/aA=r-1$であるから，帰納法の仮定より$\dim A/aA=d-1=r-1$である．よって$r=d$となることがわかった．
\end{proof}

\section{Koszul複体}

まず一般に，複体のテンソル積について定義しておく．
\begin{defi}[複体のテンソル積]
	$K_\bullet,L_\bullet$を$A$加群の複体とする．二重複体$W_{p,q}=K_p\otimes L_q$の全複体；
	\[T_n=\bigoplus_{p+q=n} K_p\otimes L_q,\quad d_n=\sum_{p+q=n} d'_p\otimes\id_q+(-1)^p\id_p\otimes d''_q\]
	を$K_\bullet, L_\bullet$の\textbf{テンソル積複体}といい，$K_\bullet\otimes L_\bullet$で表す．
\end{defi}



%
%\section{Gorenstein環とMatlisの双対定理}
%
%\begin{thm}[Gorenstein環の特徴づけ]
%	$(A,\ideal{m},k)$を$d$次元のNoether局所環とする．このとき次の条件；
%	\begin{sakura}
%		\item $A$はGorensteinである．
%		\item $\injdim A=d$である．
%		\item $\Ext^d_A(k,A)\cong k$であり，任意の$i\neq d$について$\Ext^i_A(k,A)=0$である．
%		\item $A$はCM環であり，$\Ext^d_A(k,A)\cong k$である．
%		\item $A$はCM環であり，巴系から生成されるイデアルで既約なものが存在する．
%	\end{sakura}
%	は同値である．
%\end{thm}
%
%\begin{proof}
%	\begin{eqv}[5]
%		\item \ref{thm:Gorensteinのinjdim}．
%		\item $d$についての帰納法で示す．まず$d=0$とすると，$\ideal{m}\in\ass A$より$\ideal{m}=\ann x$とかける$x\in A$が存在する．このとき，単射$\iota:k\to A;a+\ann x\mapsto ax$が誘導する$\iota^\ast:\hom(A,A)=A\to\hom(k,A)$を考えると，これは$a$倍写像を$ax$倍写像に対応させるものにほかならず，その核は$\ideal{m}$である．また$\injdim A=0$より$A$が入射的なので全射なので．$\hom(k,A)\cong k$である．また$\injdim A=0$だから$i>0$について$\Ext^i(k,A)=0$となる．次に$d-1$まで正しいとすると，\ref{thm:Gorensteinのinjdim}と同様の議論から$A$正則元$a\in\ideal{m}$が存在し，$A/aA$は$d-1$次元のGorenstein環である．\ref{lem:A/aAのExt}と帰納法の仮定から；
%		\[\Ext^i_A(k,A)=\Ext^{i-1}_{A/aA}{k,A/aA}=\begin{cases}
%			k&(i=d)\\0&(i\neq d)
%		\end{cases}\]
%		であるので題意が成り立つ．
%		\item $\mdepth A=\min\mkset{i\in\N}{\Ext^i(K,A)\neq0}$であったことを思い出すと，$\mdepth A=\dim A=d$であることがわかる．
%	\end{eqv}
%\end{proof}